services:
    client-server:
        build:
            context: ../
            dockerfile: docker/Dockerfile
        env_file:
            - ../.env
        networks:
            - internos
        volumes:
            - ../:/app
            - /app/node_modules
        ports:
            - '9001:9001'
            - '9002:9002'
            - '9003:9003'
            - '9526:9526'
            - '9527:9527'
            - '9528:9528'
            - '5183:5183'
        extra_hosts:
            - 'host.docker.internal:host-gateway'
        environment:
            - VIRTUAL_HOST=shinobifarm.localhost,shinobifarm.jogatinando.shop,localhost
            - VIRTUAL_PORT=9001,9002,9003,9526,9527,9528,5183
            - VIRTUAL_PROTO=ws,http

    nginx:
        image: nginx:alpine
        volumes:
            - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
        ports:
            - '80:80'
        depends_on:
            - client-server
        networks:
            - internos

networks:
    internos:
        external: true
